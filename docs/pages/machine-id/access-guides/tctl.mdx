---
title: Machine ID with tctl
description: How to use Machine ID with tctl to manage your Teleport configuration
---

`tctl` is the Teleport cluster management CLI tool. Whilst it usually uses the
credentials from the locally logged in user, it is also possible to use
Machine ID credentials. This allows `tctl` to be leveraged as part of a custom
automation workflow deployed in a non-interactive environment (e.g CI/CD).

In this guide, you will configure `tbot` to produce credentials for `tctl`, and
then use `tctl` to deploy Teleport roles defined in files.

## Prerequisites

(!docs/pages/includes/edition-prereqs-tabs.mdx!)

- (!docs/pages/includes/tctl.mdx!)
- `tbot` must already be installed and configured on the machine that will
  use `tctl`. For more information, see the
  [deployment guides](../deployment.mdx).

## Step 1/3. Configure RBAC

First, Teleport must be configured to allow the credentials produced by `tbot`
to modify the Teleport configuration. It's important to grant as few
privileges as possible in order to limit the blast radius of an attack, so in
this example we grant only the ability to create and update roles.

If you have followed a platform guide, you will have created a role and granted
the bot the ability to impersonate it already. This role just needs to have the
additional privileges added to it.

Use `tctl edit role/example-bot` to add the following rule to the role:

```yaml
spec:
  allow:
    rules:
    - resources:
      # Specify the names of resources you wish to manage with tctl.
      # For this guide, we will only manage roles.
      - role
      verbs:
      - create
      - read
      - update
      - delete
      - list
```

## Step 2/3. Configure `tbot` output

(!docs/pages/includes/plugins/tbot-identity.mdx workload="tctl"!)

## Step 3/3. Use `tctl` with the identity output

As an example, `tctl` will be used to apply a directory of YAML files that
define Teleport roles. If these were stored in version control (e.g., `git`) and
this were executed on change, this would form the basis for managing Teleport
roles in a GitOps style.

The example role will not be useful within the context of your Teleport cluster
and should be modified once you have completed this guide.

Create a directory called `roles/` and within it create `example.yaml`:

```yaml
kind: role
version: v6
metadata:
  name: tctl-test
spec:
  # This role does nothing as it is an example role.
  allow: {}
```

To configure `tctl` to use the identity file, the `-i` flag is used. As the
identity file does not specify the address of Teleport, `--auth-server` must
also be specified with the address of your Teleport Proxy or Teleport Auth
Server.

Run `tctl`, replacing `example.teleport.sh:443` with the address of your
Teleport Proxy or Auth Server and `/opt/machine-id/identity` with the path to
the generated identity file if you have modified this:

```code
$ tctl --auth-server example.teleport.sh:443 -i /opt/machine-id/identity create -f roles/*.yaml
```

Check your Teleport cluster, ensuring the role has been created.

```code
$ tctl get role/tctl-test
```

## Next steps

- Explore the [`tctl` reference](../../reference/cli/tctl.mdx) to discover all
  `tctl` can do.
- Read the [configuration reference](../reference/configuration.mdx) to explore
  all the available `tbot` configuration options.
