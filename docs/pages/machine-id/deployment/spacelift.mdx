---
title: Deploying Machine ID on Spacelift
description: How to install and configure Machine ID on Spacelift
---

Spacelift is a popular Terraform CI/CD platform. Configuring Machine ID for
Spacelift allows the Teleport Terraform Provider to access your Teleport cluster
without the need for long-lived secrets.

## Prerequisites

(!docs/pages/includes/edition-prereqs-tabs.mdx!)

- (!docs/pages/includes/tctl.mdx!)
- Your user should have the privileges to create token resources.
- A paid Spacelift account and a Spacelift stack you wish to allow access to
  your Teleport cluster.

## Step 1/3. Create a join token for Spacelift

In order to allow your Spacelift stack to authenticate with your Teleport
cluster, you'll first need to create a join token. These tokens set out
criteria by which the Auth Server decides whether to allow a bot or node
to join.

In this example, you will create a join token that grants access to any
execution within a specific Spacelift stack.

Create a file named `bot-token.yaml`:

```yaml
kind: token
version: v2
metadata:
  name: example-bot
spec:
  # The Bot role indicates that this token grants access to a bot user, rather
  # than allowing a node to join. This role is built in to Teleport.
  roles: [Bot]
  join_method: spacelift
  # The bot_name indicates which bot user this token grants access to. This
  # should match the name of the bot that you will create in the next step.
  bot_name: example
  spacelift:
    # hostname should be the hostname of your Spacelift tenant.
    hostname: example.app.spacelift.io
    # allow specifies rules that control which Spacelift executions will be
    # granted access. Those not matching any allow rule will be denied.
    allow:
    # space_id identifies the space that the module or stack resides within.
    - space_id: root
      # caller_type is the type of caller_id. This must be `stack` or `module`.
      caller_type: stack
      # caller_id is the id of the caller. e.g the name of the stack or module.
      caller_id: my-stack
```

Replace:
- `example.app.spacelift.io`
- `root`
- `my-stack`

Once the resource file has been written, create the token with `tctl`:

```code
$ tctl create -f bot-token.yaml
```

Check that token `example-bot` has been created with the following
command:

```code
$ tctl tokens ls
Token       Type Labels Expiry Time (UTC)
----------- ---- ------ ----------------------------------------------
example-bot Bot
```

## Step 2/3. Create a role and Machine ID bot

(!docs/pages/includes/machine-id/blank-role.mdx!)

Create the bot, specifying the role and token that you have created:

```code
$ tctl bots add example --roles=example-bot --token=example-bot
```

## Step 3/3. Configure your Spacelift Stack

Now that the bot has been successfully created, you now need to configure your
Spacelift stack to authenticate as this bot using `tbot` and then configure
the Terraform provider to use the credentials produced by `tbot`.

To help with this, Teleport publishes a custom Spacelift container image. This
image is based on the default image provided by Spacelift but additionally
includes `tbot`.

## Next steps

- Find out more about Spacelift's OIDC implementation, read
[their documentation](https://docs.spacelift.io/integrations/cloud-providers/oidc/).
- [More information about `anonymous-telemetry`.](../reference/telemetry.mdx)

